---
title: å°ç¨‹åºæ¨¡æ¿
date: 2023-01-05 19:57:24
tags:
---

# å°ç¨‹åºæ¨¡æ¿æ„å»º

é€‰æ‹©å¼€å‘è€…å·¥å…·ä¸­çš„ typescript+sass æ¨¡ç‰ˆ

## ä½¿ç”¨ npm

åœ¨ miniprogram ä¸­
æ›¿æ¢ project.config.json

```json
// åœ¨settingä¸­æ·»åŠ 
    "packNpmManually": true,

    "packNpmRelationList": [

      {
        "packageJsonPath": "./miniprogram/package.json",

        "miniprogramNpmDistDir": "miniprogram/"
      }
    ],
```

åœ¨å¼€å‘è€…å·¥å…·å³ä¾§**è¯¦æƒ…**ä¸­å‹¾é€‰**ä½¿ç”¨ npm æ¨¡å—**
æœ€ååœ¨å¼€å‘è€…å·¥å…·**å·¥å…·æ **é€‰å–**æ„å»º npm**

## ç»„ä»¶åº“ä½¿ç”¨ vant-weapp

```
pnpm i @vant/weapp -S --production
```

```wxss
// åœ¨app.wxssä¸­æ·»åŠ 
@import "./miniprogram_npm//@vant/weapp/common/index.wxss";
```

**ä½¿ç”¨çš„æ—¶å€™è¦åœ¨ json ä¸­æ·»åŠ é…ç½®ï¼ˆtodo: æš‚æ—¶æ²¡æœ‰ unplugin æ’ä»¶ï¼Œä¹‹åè‡ªå·±æä¸€ä¸ªè¯•ä¸€ä¸‹ï¼‰**

```
"usingComponents": {
  "van-button": "/miniprogram_npm/@vant/weapp/button/index"
}
```

## .gitignore

æ–°å»º.gitignore æ–‡ä»¶

```
miniprogram/miniprogram_npm/*
miniprogram/node_modules/*
node_modules/*
```

## miniprogram-computed

æä¾›ç»™ä½ å‘ vue ä¸€æ ·çš„ computed è®¡ç®—å±æ€§å’Œ watch ç›‘å¬å™¨

**è¿™ä¸ªåŒ…æœ‰ä¸¤ä¸ªä¾èµ–**

```
pnpm install --save miniprogram-computed
pnpm install rfdc --save
pnpm install fast-deep-equal
```

```ts
import { ComponentWithComputed } from "miniprogram-computed";

ComponentWithComputed({
  data: {
    a: 1,
    b: 1,
    c: 1,
    sum: 2,
  },
  watch: {
    "a, b": function (a, b) {
      this.setData({
        c: a + b,
      });
    },
  },
  computed: {
    sum(data) {
      // æ³¨æ„ï¼š computed å‡½æ•°ä¸­ä¸èƒ½è®¿é—® this ï¼Œåªæœ‰ data å¯¹è±¡å¯ä¾›è®¿é—®
      // è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼ä¼šè¢«è®¾ç½®åˆ° this.data.sum å­—æ®µä¸­
      return data.a + data.b + data.c; // data.c ä¸ºè‡ªå®šä¹‰ behavior æ•°æ®æ®µ
    },
  },
  methods: {
    onTapa() {
      this.setData({
        a: this.data.a + 1,
      });
    },
    onTapb() {
      this.setData({
        b: this.data.b + 2,
      });
    },
  },
});
```

## å®˜æ–¹ä¸“ç”¨å…¨å±€çŠ¶æ€ç®¡ç†æœº mobx

```
pnpm install --save mobx-miniprogram mobx-miniprogram-bindings
```

```ts
// store/index.ts
import { configure } from "mobx-miniprogram";
export { test } from "./test";

// mobxé…ç½®
// åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œä¸å…è®¸åœ¨ action å¤–æ›´æ”¹ä»»ä½•çŠ¶æ€ã€‚
configure({ enforceActions: "observed" });
```

```ts
// store/test.ts
import { observable, runInAction } from "mobx-miniprogram";

export const test = observable({
  numA: 1000,
  numB: 1000,

  get sum() {
    return this.numA + this.numB;
  },

  double_data: function () {
    runInAction(() => {
      this.numA = this.numA * 2;
      this.numB = this.numB * 2;
    });
  },
});
```

```ts
// component
import { ComponentWithStore } from "mobx-miniprogram-bindings";
import { test } from "../../store/index";

ComponentWithStore({
  properties: {
    title: {
      type: String,
      value: "",
    },
  },
  options: {
    styleIsolation: "shared",
  },
  data: {
    someData: "...",
  },
  storeBindings: {
    store: test,
    fields: ["numA", "numB", "sum"],
    actions: {
      buttonTap: "double_data",
    },
  },
});
```

## åŸå­åŒ– css

```
pnpm i -D unocss unocss-preset-weapp @unocss/cli
```

```json
// package.json
"unocss": "unocss miniprogram/**/*.wxml -c unocss.config.js --watch -o miniprogram/unocss.wxss",
"unocss:build": "unocss miniprogram/**/*.wxml -c unocss.config.js -o  miniprogram/unocss.wxss"
```

```js
// unocss.config.js

import { defineConfig } from "unocss";
import presetWeapp from "unocss-preset-weapp";
export default defineConfig({
  include: [/\.wxml$/],
  presets: [presetWeapp()],
});
```

## å›½é™…åŒ–â€”â€”miniprogram-i18n

```
pnpm i -D gulp @miniprogram-i18n/gulp-i18n-locales @miniprogram-i18n/gulp-i18n-wxml
```

åœ¨å°ç¨‹åºæºç ä¸­ pnpm init æ–°å»º package.json å¹¶

```
pnpm i -S @miniprogram-i18n/core
```

åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º gulpfile.jsï¼Œå¹¶ç¼–å†™æ„å»ºè„šæœ¬

```js
const { src, dest, series } = require("gulp");
const gulpI18nWxml = require("@miniprogram-i18n/gulp-i18n-wxml");
const gulpI18nLocales = require("@miniprogram-i18n/gulp-i18n-locales");

function mergeAndGenerateLocales() {
  return src("miniprogram/i18n/*.json")
    .pipe(gulpI18nLocales({ defaultLocale: "zh-CN", fallbackLocale: "zh-CN" }))
    .pipe(dest("miniprogram/i18n/"));
}

function transpileWxml() {
  return src("miniprogram/**/*.wxml")
    .pipe(
      gulpI18nWxml({
        wxsPath: "miniprogram/i18n/locales.wxs",
      })
    )
    .pipe(dest("dist/"));
}

function copyToDist() {
  return src([
    "miniprogram/**/*",
    "!miniprogram/**/*.wxml",
    "!miniprogram/i18n/*.json",
  ]).pipe(dest("dist/"));
}

exports.default = series(copyToDist, transpileWxml, mergeAndGenerateLocales);
```

æ·»åŠ åŒ…å‘½ä»¤å¹¶æ‰§è¡Œ pnpm build

```js
// æ ¹ç›®å½•package.js
    "scripts": {
        "build": "gulp"
    },
```

ä¿®æ”¹æ¨¡æ‹Ÿå™¨æ˜ å°„ project.config.json

```json
 "miniprogramRoot": "dist/"
 "packNpmRelationList": [
            {
                "packageJsonPath": "./miniprogram/package.json",
                "miniprogramNpmDistDir": "dist/"
            }
        ]
```

## ESlint

å› ä¸ºæœ¬èº«å°±æœ‰é…ç½®æ–‡ä»¶åœ¨æ–°å»ºé¡¹ç›®çš„æ—¶å€™ç”Ÿæˆ

```
pnpm i eslint -D
pnpm install @typescript-eslint/parser --save-dev
pnpm install @typescript-eslint/eslint-plugin --save-dev
```

é…ç½®æ–‡ä»¶ä¿®æ”¹ä»¥é€‚åº” ts

```js
"plugins": ['@typescript-eslint'],
"parserOptions": {
        "parser": "@typescript-eslint/parser",
    },
```

å¢åŠ  eslint å‘½ä»¤

```
npm set-script eslint "eslint --ext .js,.vue --ignore-path .gitignore --fix miniprogram"
```

åˆ é™¤ eslint é…ç½®æ–‡ä»¶ ecmaFeatures é¡¹;

**å…³é—­æ ¡éªŒ**
```
/* eslint-disable */
    ä»£ç å—
/* eslint-enable */
ä¸€è¡Œä»£ç  // eslint-disable-line
// eslint-disable-next-line
ä¸‹ä¸€è¡Œçš„ä»£ç 
/* eslint-disable */(æ”¾å¤´éƒ¨å…³é—­æ•´ä¸ªæ–‡ä»¶çš„æ ¡éªŒ)
```

## Prettier

```
pnpm i prettier eslint-config-prettier eslint-plugin-prettier -D
```

æ ¹ç›®å½•æ–°å»º.prettierignore

```
miniprogram/miniprogram_npm/*
miniprogram/node_modules/*
node_modules/*
```

æ ¹ç›®å½•æ–°å»º.prettierrc.js

```js
module.exports = {
  // ä¸€è¡Œæœ€å¤š 80 å­—ç¬¦
  printWidth: 80,
  // ä½¿ç”¨ 4 ä¸ªç©ºæ ¼ç¼©è¿›
  tabWidth: 4,
  // ä¸ä½¿ç”¨ tab ç¼©è¿›ï¼Œè€Œä½¿ç”¨ç©ºæ ¼
  useTabs: false,
  // è¡Œå°¾éœ€è¦æœ‰åˆ†å·
  semi: true,
  // ä½¿ç”¨å•å¼•å·ä»£æ›¿åŒå¼•å·
  singleQuote: true,
  // å¯¹è±¡çš„ key ä»…åœ¨å¿…è¦æ—¶ç”¨å¼•å·
  quoteProps: "as-needed",
  // jsx ä¸ä½¿ç”¨å•å¼•å·ï¼Œè€Œä½¿ç”¨åŒå¼•å·
  jsxSingleQuote: false,
  // æœ«å°¾ä½¿ç”¨é€—å·
  trailingComma: "all",
  // å¤§æ‹¬å·å†…çš„é¦–å°¾éœ€è¦ç©ºæ ¼ { foo: bar }
  bracketSpacing: true,
  // jsx æ ‡ç­¾çš„åå°–æ‹¬å·éœ€è¦æ¢è¡Œ
  jsxBracketSameLine: false,
  // ç®­å¤´å‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦æ‹¬å·
  arrowParens: "always",
  // æ¯ä¸ªæ–‡ä»¶æ ¼å¼åŒ–çš„èŒƒå›´æ˜¯æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹
  rangeStart: 0,
  rangeEnd: Infinity,
  // ä¸éœ€è¦å†™æ–‡ä»¶å¼€å¤´çš„ @prettier
  requirePragma: false,
  // ä¸éœ€è¦è‡ªåŠ¨åœ¨æ–‡ä»¶å¼€å¤´æ’å…¥ @prettier
  insertPragma: false,
  // ä½¿ç”¨é»˜è®¤çš„æŠ˜è¡Œæ ‡å‡†
  proseWrap: "preserve",
  // æ ¹æ®æ˜¾ç¤ºæ ·å¼å†³å®š html è¦ä¸è¦æŠ˜è¡Œ
  htmlWhitespaceSensitivity: "css",
  // æ¢è¡Œç¬¦ä½¿ç”¨ lf
  endOfLine: "auto",
};
```

```
npm set-script prettier "prettier --write ./miniprogram/**/*.{ts,tsx,js,jsx,css,less,scss,json,md}"
```

## stylelint

```
pnpm add stylelint stylelint-config-standard stylelint-scss stylelint-order -D
```

æ ¹ç›®å½•æ–°å»º.stylelintrc.js

```js
module.exports = {
  plugins: ['stylelint-scss', 'stylelint-order'],
  extends: ["stylelint-config-standard-scss"],
  ignoreFiles: [
    "**/*.js",
    "**/*.jsx",
    "**/*.tsx",
    "**/*.ts",
    "**/*.json",
    "**/*.md",
    "**/*.yaml",
  ],
  rules: {
    "unit-no-unknown": [true, { ignoreUnits: ['rpx']}],
    "unit-allowed-list": ["rpx", "%", "px"],
    "no-descending-specificity": null, // ç¦æ­¢åœ¨å…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨åå‡ºç°è¢«å…¶è¦†ç›–çš„è¾ƒä½ä¼˜å…ˆçº§çš„é€‰æ‹©å™¨
    "selector-pseudo-element-no-unknown": [
      true,
      {
        ignorePseudoElements: ["v-deep"],
      },
    ],
    "selector-pseudo-class-no-unknown": [
      true,
      {
        ignorePseudoClasses: ["deep"],
      },
    ],
    "import-notation": "string",
    "comment-whitespace-inside": "always",
    // æŒ‡å®šæ ·å¼çš„æ’åº
    "order/properties-order": [
      "position",
      "top",
      "right",
      "bottom",
      "left",
      "z-index",
      "display",
      "justify-content",
      "align-items",
      "float",
      "clear",
      "overflow",
      "overflow-x",
      "overflow-y",
      "padding",
      "padding-top",
      "padding-right",
      "padding-bottom",
      "padding-left",
      "margin",
      "margin-top",
      "margin-right",
      "margin-bottom",
      "margin-left",
      "width",
      "min-width",
      "max-width",
      "height",
      "min-height",
      "max-height",
      "font-size",
      "font-family",
      "text-align",
      "text-justify",
      "text-indent",
      "text-overflow",
      "text-decoration",
      "white-space",
      "color",
      "background",
      "background-position",
      "background-repeat",
      "background-size",
      "background-color",
      "background-clip",
      "border",
      "border-style",
      "border-width",
      "border-color",
      "border-top-style",
      "border-top-width",
      "border-top-color",
      "border-right-style",
      "border-right-width",
      "border-right-color",
      "border-bottom-style",
      "border-bottom-width",
      "border-bottom-color",
      "border-left-style",
      "border-left-width",
      "border-left-color",
      "border-radius",
      "opacity",
      "filter",
      "list-style",
      "outline",
      "visibility",
      "box-shadow",
      "text-shadow",
      "resize",
      "transition",
    ],
  },
};
```

package.json å¢åŠ å‘½ä»¤

```
    "stylelint": "stylelint ./miniprogram/**/*.{scss,css} --fix"
```

### huskyï¼ˆè§„èŒƒä»£ç æäº¤ï¼‰

```
pnpm add husky -D
```

å¢åŠ  package.json æŒ‡ä»¤ prepare å¹¶æ‰§è¡Œ

```
npm set-script prepare "husky install"
```

```
pnpm husky add .husky/pre-commit "pnpm eslint && pnpm prettier && pnpm stylelint"
```

### commitlint å’Œ commitizen(æäº¤ä¿¡æ¯è§„èŒƒ)

```
pnpm i commitlint @commitlint/config-conventional cz-conventional-changelog commitizen -D
npm set-script commit "git add . && git-cz"
pnpm i -D commitlint-config-cz  cz-customizable
```

æ ¹ç›®å½•æ–°å»º commitlint.config.js å’Œ cz-config.js

```commitlint.config.js
module.exports = {
    extends:  ['cz'],
    rules: {
        // è‡ªå®šä¹‰è§„åˆ™
    }
}
```

```cz-config.js
'use strict'
module.exports = {
  types: [
    { value: 'âœ¨æ–°å¢', name: 'æ–°å¢:    æ–°çš„å†…å®¹' },
    { value: 'ğŸ›ä¿®å¤', name: 'ä¿®å¤:    ä¿®å¤ä¸€ä¸ªBug' },
    { value: 'ğŸ“æ–‡æ¡£', name: 'æ–‡æ¡£:    å˜æ›´çš„åªæœ‰æ–‡æ¡£' },
    { value: 'ğŸ’„æ ¼å¼', name: 'æ ¼å¼:    ç©ºæ ¼, åˆ†å·ç­‰æ ¼å¼ä¿®å¤' },
    { value: 'â™»ï¸é‡æ„', name: 'é‡æ„:    ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œç‰¹æ€§ã€ä¿®å¤åŒºåˆ†å¼€' },
    { value: 'âš¡ï¸æ€§èƒ½', name: 'æ€§èƒ½:    æå‡æ€§èƒ½' },
    { value: 'âœ…æµ‹è¯•', name: 'æµ‹è¯•:    æ·»åŠ ä¸€ä¸ªæµ‹è¯•' },
    { value: 'ğŸ”§å·¥å…·', name: 'å·¥å…·:    å¼€å‘å·¥å…·å˜åŠ¨(æ„å»ºã€è„šæ‰‹æ¶å·¥å…·ç­‰)' },
    { value: 'âªå›æ»š', name: 'å›æ»š:    ä»£ç å›é€€' }
  ],
  scopes: [
    { name: 'leetcode' },
    { name: 'javascript' },
    { name: 'typescript' },
    { name: 'Vue' },
    { name: 'node' }
  ],
  // it needs to match the value for field type. Eg.: 'fix'
  /*  scopeOverrides: {
    fix: [
      {name: 'merge'},
      {name: 'style'},
      {name: 'e2eTest'},
      {name: 'unitTest'}
    ]
  },  */
  // override the messages, defaults are as follows
  messages: {
    type: 'é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:',
    scope: 'é€‰æ‹©ä¸€ä¸ªscope (å¯é€‰):',
    // used if allowCustomScopes is true
    customScope: 'Denote the SCOPE of this change:',
    subject: 'çŸ­è¯´æ˜:\n',
    body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š\n',
    breaking: 'éå…¼å®¹æ€§è¯´æ˜ (å¯é€‰):\n',
    footer: 'å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#31, #34(å¯é€‰):\n',
    confirmCommit: 'ç¡®å®šæäº¤è¯´æ˜?(yes/no)'
  },
  allowCustomScopes: true,
  allowBreakingChanges: ['ç‰¹æ€§', 'ä¿®å¤'],
  // limit subject length
  subjectLimit: 100
}
```

```package.json
  // package.json
    "config": {
        "commitizen": {
            "path": "node_modules/cz-customizable"
        }
    }
```

### changeLog And version(ä½¿ç”¨ conventional-changelog-cli å’Œ standard-version)

```
// ä¸‹è½½
npm install -s conventional-changelog-cli

// é…ç½® package.json
"scripts": {
    "changelog": "conventional-changelog -p angular -i CHANGELOG.md -s -r 0"
}
```

```
// ä¸‹è½½
npm install --save-dev standard-version

// é…ç½® package.json
"scripts": {
    "release": "standard-version"
}
```

### axios

```
pnpm i axios
```

å°è£…

è¿™é‡Œå°±ä¸å¾—ä¸è¯´è¯´å°è£…çš„æ„ä¹‰ï¼šæˆ‘ä»¬å…ˆè¯´è¯´å¦‚æœä¸å°è£…ä¼šæ€ä¹ˆæ ·ï¼Ÿæ²¡æœ‰æ‹¦æˆªå™¨ï¼Œæ¯æ¬¡éœ€è¦å¯¹å‚æ•°ã€ç”¨æˆ·æ ‡è¯†è¿›è¡Œä¿®æ”¹æ—¶å°±è¦å†™ä¸€æ¬¡ï¼Œæ‰€ä»¥å°è£…èƒ½å¤Ÿæå¤§æé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚

è¿™æ˜¯ä»äººå®¶æ–‡ç« æŒ–çš„å›¾ã€‚æš‚æ—¶å…ˆç”¨ç€ã€‚
<img src="../images/axios.webp" />
è¿™å›¾çªå‡ºäº†å°è£…çš„ä¸¤ä¸ªè¦ç‚¹ï¼šæµç¨‹ + æ‹¦æˆª

#### index.ts ä¸»æµç¨‹

```typescript
import axios from "axios";

type ResponseHandle = (data: ResponseData<any>) => unknown;

interface RequestData {
  [key: string]: unknown;
}

interface ResponseData<T> {
  errno: string;
  errmsg: string;
  data: T;
}

const get = <T>(
  url: string,
  params: RequestData = {},
  filter?: ResponseHandle
): Promise<[any, ResponseData<T> | undefined]> =>
  new Promise((resolve) => {
    axios
      .get(url, { params })
      .then((result) => {
        let res: ResponseData<T>;
        if (filter !== undefined) {
          res = filter(result.data) as unknown as ResponseData<T>;
        } else {
          res = result.data as ResponseData<T>;
        }
        resolve([null, res as ResponseData<T>]);
      })
      .catch((err) => {
        resolve([err, undefined]);
      });
  });

export const post = <T>(
  url: string,
  data: RequestData,
  params: RequestData = {}
): Promise<[any, ResponseData<T> | undefined]> => {
  return new Promise((resolve) => {
    axios
      .post(url, data, { params })
      .then((result) => {
        resolve([null, result.data as ResponseData<T>]);
      })
      .catch((err) => {
        resolve([err, undefined]);
      });
  });
};

export const put = <T>(
  url: string,
  data: RequestData,
  params: RequestData = {}
): Promise<[any, ResponseData<T> | undefined]> => {
  return new Promise((resolve) => {
    axios
      .post(url, data, { params })
      .then((result) => {
        resolve([null, result.data as ResponseData<T>]);
      })
      .catch((err) => {
        resolve([err, undefined]);
      });
  });
};

export const del = <T>(
  url: string,
  data: RequestData,
  params: RequestData = {}
): Promise<[any, ResponseData<T> | undefined]> => {
  return new Promise((resolve) => {
    axios
      .post(url, data, { params })
      .then((result) => {
        resolve([null, result.data as ResponseData<T>]);
      })
      .catch((err) => {
        resolve([err, undefined]);
      });
  });
};
```

#### é”™è¯¯å¤„ç†

```typescript
const handleNetworkError = (errStatus) => {
  let errMessage = "æœªçŸ¥é”™è¯¯";
  if (errStatus) {
    switch (errStatus) {
      case 400:
        errMessage = "é”™è¯¯çš„è¯·æ±‚";
        break;
      case 401:
        errMessage = "æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•";
        break;
      case 403:
        errMessage = "æ‹’ç»è®¿é—®";
        break;
      case 404:
        errMessage = "è¯·æ±‚é”™è¯¯,æœªæ‰¾åˆ°è¯¥èµ„æº";
        break;
      case 405:
        errMessage = "è¯·æ±‚æ–¹æ³•æœªå…è®¸";
        break;
      case 408:
        errMessage = "è¯·æ±‚è¶…æ—¶";
        break;
      case 500:
        errMessage = "æœåŠ¡å™¨ç«¯å‡ºé”™";
        break;
      case 501:
        errMessage = "ç½‘ç»œæœªå®ç°";
        break;
      case 502:
        errMessage = "ç½‘ç»œé”™è¯¯";
        break;
      case 503:
        errMessage = "æœåŠ¡ä¸å¯ç”¨";
        break;
      case 504:
        errMessage = "ç½‘ç»œè¶…æ—¶";
        break;
      case 505:
        errMessage = "httpç‰ˆæœ¬ä¸æ”¯æŒè¯¥è¯·æ±‚";
        break;
      default:
        errMessage = `å…¶ä»–è¿æ¥é”™è¯¯ --${errStatus}`;
    }
  } else {
    errMessage = `æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼`;
  }

  translateError(errMessage);

  return errMessage;
};

const handleAuthError = (errno) => {
  const authErrMap: any = {
    "10031": "ç™»å½•å¤±æ•ˆï¼Œéœ€è¦é‡æ–°ç™»å½•", // token å¤±æ•ˆ
    "10032": "æ‚¨å¤ªä¹…æ²¡ç™»å½•ï¼Œè¯·é‡æ–°ç™»å½•~", // token è¿‡æœŸ
    "10033": "è´¦æˆ·æœªç»‘å®šè§’è‰²ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ç»‘å®šè§’è‰²",
    "10034": "è¯¥ç”¨æˆ·æœªæ³¨å†Œï¼Œè¯·è”ç³»ç®¡ç†å‘˜æ³¨å†Œç”¨æˆ·",
    "10035": "code æ— æ³•è·å–å¯¹åº”ç¬¬ä¸‰æ–¹å¹³å°ç”¨æˆ·",
    "10036": "è¯¥è´¦æˆ·æœªå…³è”å‘˜å·¥ï¼Œè¯·è”ç³»ç®¡ç†å‘˜åšå…³è”",
    "10037": "è´¦å·å·²æ— æ•ˆ",
    "10038": "è´¦å·æœªæ‰¾åˆ°",
  };

  translateError(errno);

  if (authErrMap.hasOwnProperty(errno)) {
    // ç”¨ç»„ä»¶æç¤º
    // message.error(authErrMap[errno])
    // æˆæƒé”™è¯¯ï¼Œç™»å‡ºè´¦æˆ·
    // logout()
    return false;
  }

  return true;
};

const handleGeneralError = (errno, errmsg) => {
  if (errno !== "0") {
    translateError(errmsg);
    // ç”¨ç»„ä»¶æç¤º
    // meessage.error(err.errmsg)
    return false;
  }

  return true;
};

const translateError = (msg) => {
  // é€šè¿‡ç»„ä»¶å’Œç¿»è¯‘é€»è¾‘ç»™ç”¨æˆ·çœ‹é”™è¯¯åŸå› 
  console.log(msg);
};

export default {
  handleNetworkError,
  handleAuthError,
  handleGeneralError,
};
```

#### è¯·æ±‚æ‹¦æˆªå™¨

```typescript
import axios, { AxiosRequestConfig } from "axios";
import handleError from "./handleError";

const handleRequestHeader = (config: AxiosRequestConfig<any>) => {
  // å¯†é’¥
  return config;
};

const handleAuth = (config: AxiosRequestConfig<any>) => {
  // wx.getStorage({key: 'token'}) || token || ''
  return config;
};

axios.interceptors.request.use(
  (config) => {
    config = handleRequestHeader(config);
    config = handleAuth(config);
    return config;
  },
  (err) => {
    handleError.handleGeneralError(-1, err);
    Promise.reject(err);
  }
);
```

#### å“åº”æ‹¦æˆªå™¨

```typescript
import axios from "axios";
import handleError from "./handleError";

axios.interceptors.response.use(
  (response) => {
    // å“åº”å¤„ç†
    if (response.status !== 200) return Promise.reject(response.data);

    handleError.handleAuthError(response.data.errno);
    handleError.handleGeneralError(response.data.errno, response.data.errmsg);

    return response;
  },
  (err) => {
    // å¯¹å“åº”é”™è¯¯åšå¤„ç†
    handleError.handleNetworkError(err.response.status);
    Promise.reject(err.response);
  }
);
```

## ç¯å¢ƒé…ç½®

å°ç¨‹åºæ²¡æœ‰ process å¯¹è±¡ã€‚åªèƒ½è‡ªå·±æ‰‹åŠ¨äº†

æ ¹ç›®å½•åˆ›å»º config.js

```js
// baseurl
const env = "dev";

export const baseApi = function () {
  if (env === "development") {
    console.log("å¼€å‘ç¯å¢ƒ");
    return "http://ipåœ°å€:ç«¯å£å·/cloud_job";
  } else {
    console.log("ç”Ÿäº§ç¯å¢ƒ");
    return "https://IPåœ°å€/cloud_job";
  }
};
// baseSocket
export const baseSocket = function () {
  if (env === "development") {
    console.log("å¼€å‘ç¯å¢ƒé•¿é“¾æ¥");
    return "ws://IPåœ°å€:ç«¯å£å·/cloud_job/im";
  } else {
    console.log("ç”Ÿäº§ç¯å¢ƒé•¿é“¾æ¥");
    return "wss://IPåœ°å€/cloud_job/im";
  }
};
```

## ä¸šåŠ¡

### mock

å°ç¨‹åºæœ‰è‡ªå¸¦çš„è°ƒè¯•å° mock
