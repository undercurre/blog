---
title: 模板建成记
date: 2022-11-16 00:02:40
tags:
---

讲个笑话：我以前以为模板就是框架

# 模板

简单点说，就是开发的时候一大堆工具的集成体，相当于工具箱咯！

好啦！等我地哩组装自己的工具箱啦！

## init a project
选个pnpm做包管理啦梗系！因为一阵要用vue所以选vite做打包工具
```
pnpm create vite
// 然后跟着指引选vue，typescript

// 框架被建出来之后你会获得一个由vue和typescript建成的最初模板（干净的一笔）
pnpm i
pnpm dev
// 出来一个vue的模板页面
```

## 集成（presets/presets.ts）
### 保证vue的运行(支持vue模板的识别与编译)
```
pnpm add @vitejs/plugin-vue @vitejs/plugin-vue-jsx -D
```
```ts
import vue from '@vitejs/plugin-vue';
import vueJsx from '@vitejs/plugin-vue-jsx';

export default [
    vue(),
    vueJsx(),
]
```
### add css
原子化css unocss
```
pnpm add unocss -D
```

```ts
// presets/presets.ts
import Unocss from 'unocss/vite'

export default [
    Unocss(),
]
```

```ts
// main.ts
import 'uno.css'
```
### 自动引入插件
```
pnpm add unplugin-auto-import -D
```
```ts
import AutoImport from 'unplugin-auto-import/vite';

export default [
    AutoImport({
        include: [ // 扫描范围
            /\.[tj]sx?$/, // .ts, .tsx, .js, .jsx
            /\.vue$/, /\.vue\?vue/, // .vue
            /\.md$/, // .md
        ],
        imports: [ // 你需要自动引入什么插件
            'vue'
        ],
        dts: './src/types/auto-imports.d.ts', // 要生成相应的类，不然过不了ts
    })
]
```
### 自动引入组件
```
npm install unplugin-vue-components -D
npm install vite-plugin-style-import -D
```
```ts
import Components from 'unplugin-vue-components/vite';
import { VantResolver, NaiveUiResolver } from 'unplugin-vue-components/resolvers';
import {
  createStyleImportPlugin,
  VantResolve
} from 'vite-plugin-style-import'


export default [
    Components({
        dirs: ['src/components/'], // 我地滴组件肯定写启哩到葛嘛
        extensions: ['vue'], //  // 组件的有效文件扩展名
        include:[/\.vue$/, /\.vue\?vue/], // 扫描范围
        resolvers: [
            VantResolver(), // 移动ui库
            NaiveUiResolver(), // PC端UI库
        ], // ui库解析器
        dts: './src/types/components.d.ts', // 要生成相应的类，不然过不了ts，在src下建types文件夹
    }),
    createStyleImportPlugin({
      resolves: [
        VantResolve()
      ],
    }),
]
```

### 图标库
```
pnpm add -D @iconify/json
```
```ts
import Icons from 'unplugin-icons/vite'
import IconsResolver from 'unplugin-icons/resolver'
import { FileSystemIconLoader } from 'unplugin-icons/loaders';

export default [
    Components({
        resolvers: [
            IconsResolver({ customCollections: ['custom'] }),
        ]
    }),
    Icons({
        compiler: 'vue3', // 适应vue3依赖
        customCollections: {
          custom: FileSystemIconLoader('./assets/svg'), // 自定义目录
        },
        autoInstall: true, // 自动安装
    }),
]
```
```vue
  <i-mdi-account-box />
  <i-mdi-alarm-off />
```

### 字体库
```
pnpm add vite-plugin-fonts -D
```

```ts
import ViteFonts from 'vite-plugin-fonts';

export default [
    ViteFonts({
      google: {
        families: ['Open Sans', 'Montserrat', 'Fira Sans'],
      },
    }),
]
```

### 国际化
```
pnpm add @intlify/vite-plugin-vue-i18n -D
```

```ts
import VueI18n from '@intlify/vite-plugin-vue-i18n';

export default [
    VueI18n({
        include: ['../src/locales/'], // 翻译目录,在src下新建locales文件夹
    }),
]
```

```ts
// main.ts
import { createI18n } from 'vue-i18n'

import en from './locales/en.json'
import zh from './locales/zh-CN.json'

const i18n = createI18n({
    locale: 'zh',
    messages: {
      en,
      zh
    }
})

app.use(i18n)
```
```json
{
  "language": "English"
}
```
```json
{
  "language": "中文"
}
```
```vue
 <div>{{ $t('language') }}</div>
```

## 规范化
### ESLint（规范语法）
```
pnpm i -D eslint
npx eslint --init
上面的初始化会提示你下载下面这些
pnpm i eslint eslint-plugin-vue --save-dev
由于 ESLint 默认无法识别 TypeScript，需要安装 @typescript-eslint/parser 替代掉默认的解析器。
pnpm install @typescript-eslint/parser --save-dev
安装 @typescript-eslint/eslint-plugin 作为 eslint 默认规则的补充，提供了适用于 ts 语法的规则。
pnpm install @typescript-eslint/eslint-plugin --save-dev
```
最后在package.json中添加命令
```json
"eslint:comment": "使用 ESLint 检查并自动修复 src 目录下所有扩展名为 .js 和 .vue 的文件",
"eslint": "eslint --ext .js,.vue --ignore-path .gitignore --fix src"
```

```.eslintrc.cjs 
    // 配置vue3、ts
    "parser": "vue-eslint-parser",
    "parserOptions": {
        "parser": "@typescript-eslint/parser",
    },
```
### Prettier（规范格式）
```
pnpm i prettier eslint-config-prettier eslint-plugin-prettier --save-dev
```
在根目录新建.prettierrc.js
```package.json
  "prettier:comment": "自动格式化当前目录下的所有文件",
  "prettier": "prettier --write"
```

### 解决eslint与prettier的冲突

eslint-plugin-prettier： 基于 prettier 代码风格的 eslint 规则，即eslint使用pretter规则来格式化代码。
eslint-config-prettier： 禁用所有与格式相关的 eslint 规则，解决 prettier 与 eslint 规则冲突，确保将其放在 extends 队列最后，这样它将覆盖其他配置

```
pnpm add eslint-config-prettier eslint-plugin-prettier -D
```

```.eslintrc.cjs 
   { 
    extends: [
      'eslint:recommended',
      'plugin:vue/vue3-essential',
      'plugin:@typescript-eslint/recommended',
  +    // 新增，必须放在最后面
  +   'plugin:prettier/recommended' 
    ],
  }
```

### lint-staged
lint-staged能够让lint只检测暂存区的文件，所以速度很快。
```
pnpm add lint-staged -D
```


### stylelint（规范css）

```
pnpm add stylelint postcss postcss-less postcss-html stylelint-config-prettier stylelint-config-recommended-scss stylelint-config-standard stylelint-config-standard-vue stylelint-scss stylelint-order -D
```
```package.json
"stylelint": "stylelint \"./**/*.{css,less,vue,html}\" --fix"
```

### husky（规范提交）

```
pnpm add husky -D
```
```package.json
"prepare": "husky install"
```
```
pnpm husky add .husky/pre-commit "pnpm lint && pnpm format && pnpm lint:style"
```
该命令会在pnpm install之后运行，这样其他克隆该项目的同学就在装包的时候就会自动执行该命令来安装husky。

### commitlint和commitizen(提交规范)
commitlint规范提交插件
@commitlint/config-conventional 共享提交配置强制常规提交
commitlint-config-cz相关配置
cz-customizable自定义配置

```
pnpm i commitlint @commitlint/config-conventional -D
npm set-script commit "git add . && git-cz"
npx commitizen init cz-conventional-changelog --save-dev --save-exact
pnpm i -D commitlint-config-cz  cz-customizable
```
根目录新建commitlint.config.js和cz-config.js
```commitlint.config.js
module.exports = {
    extends:  ['cz'],
    rules: {
        // 自定义规则
    }
}
```
```cz-config.js
'use strict'
module.exports = {
  types: [
    { value: '✨新增', name: '新增:    新的内容' },
    { value: '🐛修复', name: '修复:    修复一个Bug' },
    { value: '📝文档', name: '文档:    变更的只有文档' },
    { value: '💄格式', name: '格式:    空格, 分号等格式修复' },
    { value: '♻️重构', name: '重构:    代码重构，注意和特性、修复区分开' },
    { value: '⚡️性能', name: '性能:    提升性能' },
    { value: '✅测试', name: '测试:    添加一个测试' },
    { value: '🔧工具', name: '工具:    开发工具变动(构建、脚手架工具等)' },
    { value: '⏪回滚', name: '回滚:    代码回退' }
  ],
  scopes: [
    { name: 'leetcode' },
    { name: 'javascript' },
    { name: 'typescript' },
    { name: 'Vue' },
    { name: 'node' }
  ],
  // it needs to match the value for field type. Eg.: 'fix'
  /*  scopeOverrides: {
    fix: [
      {name: 'merge'},
      {name: 'style'},
      {name: 'e2eTest'},
      {name: 'unitTest'}
    ]
  },  */
  // override the messages, defaults are as follows
  messages: {
    type: '选择一种你的提交类型:',
    scope: '选择一个scope (可选):',
    // used if allowCustomScopes is true
    customScope: 'Denote the SCOPE of this change:',
    subject: '短说明:\n',
    body: '长说明，使用"|"换行(可选)：\n',
    breaking: '非兼容性说明 (可选):\n',
    footer: '关联关闭的issue，例如：#31, #34(可选):\n',
    confirmCommit: '确定提交说明?(yes/no)'
  },
  allowCustomScopes: true,
  allowBreakingChanges: ['特性', '修复'],
  // limit subject length
  subjectLimit: 100
}
```

```package.json
  // package.json
    "config": {
        "commitizen": {
            "path": "node_modules/cz-customizable"
        }
    }
```
## 功能插件

### pinia大菠萝
```
 pnpm i pinia --save
```
新建src/store/index.ts
```
 import { createPinia } from 'pinia'

 const store = createPinia()

 export default store
```
在main.ts中引入和挂载
```
  import store from './store'
  // 挂载pinia
  app.use(store)
```

### vue-router
```
pnpm i vue-router --save
```
新建src/router/index.ts
```
 import { createRouter, createWebHistory, RouteRecordRaw } from 'vue-router';

 const routes: Array<RouteRecordRaw> = [
   {
       path: '/',
       name: 'Index',
       meta: {
           title: '首页',
           keepAlive: true,
           requireAuth: true
       },
       component: () => import('@/view/index.vue')
   }
 ]

 const router = createRouter({
   history: createWebHistory(),
   routes
 });
 export default router;
```
在main中引入和挂载
```
import router from './router';
app.use(router);
```
在App.vue中使用
```
 <template>
   <RouterView/>
 </template>
 ```
### vue-use
它是一个基于 Composition API 的实用函数集合
```
 pnpm i @vueuse/core
```
### axios
```
pnpm i axios
```
封装

这里就不得不说说封装的意义：我们先说说如果不封装会怎么样？没有拦截器，每次需要对参数、用户标识进行修改时就要写一次，所以封装能够极大提高代码的复用性。

这是从人家文章挖的图。暂时先用着。
<img src="../images/axios.webp" />
这图突出了封装的两个要点：流程 + 拦截
```

```
### css-scss

### postcss

### postcss-px-to-viewport-8-plugin

## 环境配置

## 单元测试